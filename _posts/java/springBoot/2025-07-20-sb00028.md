---
layout: single
title: "π–‹οΈ[μ¤ν”„λ§ μ‹νλ¦¬ν‹° OAuth2] ν† ν° κ²€μ¦ κµ¬ν„"
categories:
  - springBoot
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "sidebar-category"
---

# 1. JCA & JCE

## 1-1. μ†κ° λ° κµ¬μ΅°

### β“ JCA (Java Cryptography Architecture) & JCE (Java Cryptography Extention) μ†κ°
- μλ°”λ” JCA & JCE ν”„λ μ„μ›ν¬ λ¥Ό ν†µν•΄ μμ²΄μ μΈ λ³΄μ• κ΄€λ ¨ κΈ°λ¥μ„ μ κ³µν•κ³  μμΌλ©° μ „μμ„λ…(Digital Signature), λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈ(Message Digest, hashs), μΈμ¦μ„μ™€ μΈμ¦μ„ μ ν¨μ„± κ²€μ‚¬(Certificate Validation), ν‚¤ μƒμ„± λ° κ΄€λ¦¬ κ·Έλ¦¬κ³  λ³΄μ• λλ¤ μ(Secure Random Number) μƒμ„± λ“± ν„λ€ μ •λ³΄ ν†µμ‹  μ•”νΈ κΈ°μ  μ¤‘μ—μ„ ν•„μμ μΈ κ²ƒμ€ λ¨λ‘ μ κ³µν•κ³  μλ‹¤
- **JCA & JCE ν”„λ μ„μ›ν¬λ” ν”„λ΅λ°”μ΄λ” λ³΄μ• κµ¬μ΅°λ¥Ό μ‚¬μ©ν•μ—¬ λ³΄μ•κ³Ό κ΄€λ ¨ν• λ‹¤μ–‘ν• APIλ¥Ό μ κ³µν•κ³  μλ‹¤**
- ν”„λ΅λ°”μ΄λ”λ” java.security.Provider ν΄λμ¤μ κµ¬ν„μ²΄λ΅ λ³΄μ• μ•κ³ λ¦¬μ¦ κµ¬ν„μ²΄ λ©λ΅μ„ ν¬ν•¨ν•κ³  μκ³  μ΄λ¥Ό ν†µν•΄ λ³΄μ• μ„λΉ„μ¤λ¥Ό κµ¬ν„ν•  μ μλ‹¤.
- μλ¥Ό λ“¤μ–΄ νΉμ • μ•κ³ λ¦¬μ¦μ μΈμ¤ν„΄μ¤κ°€ ν•„μ”ν•΄μ§€λ©΄, JCA & JCE ν”„λ μ„μ›ν¬λ” ν”„λ΅λ°”μ΄λ” μ €μ¥μ†μ—μ„ ν•΄λ‹Ή μ•κ³ λ¦¬μ¦μ μ ν•©ν• κµ¬ν„μ²΄ ν΄λμ¤λ¥Ό μ°Ύμ•„ ν΄λμ¤ μΈμ¤ν„΄μ¤λ¥Ό μƒμ„±ν•λ”λ° ν”„λ΅λ°”μ΄λ”λ¥Ό μ§μ ‘ μ§€μ •ν•  μλ„ μλ‹¤
<img src="/assets/images/springBoot/image00000011.png">

### β“ MessageDigest
- λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈμ λ©μ μ€ μ›λ³Έ νμΌμ΄ κ·Έλ€λ΅μΈμ§€ νμ•…ν•λ” λ¬΄κ²°μ„± κ²€μ‚¬μ΄λ‹¤.
- λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈ μ•κ³ λ¦¬μ¦μ€ μ…λ ¥ κ°’μΌλ΅ μ „λ‹¬λ λ‹¤μ–‘ν• κΈΈμ΄μ μ›λ³Έ κ°’μ„ κ³ μ • κΈΈμ΄ ν•΄μ‹ κ°’μΌλ΅ μ¶λ ¥ν•λ‹¤.
- μ΄ μ•κ³ λ¦¬μ¦μ€ λ‹¨λ°©ν–¥μ΄κΈ° λ•λ¬Έμ— ν•΄μ‹ κ°’μ—μ„ κ±°κΎΈλ΅ μ›λ³Έ κ°’μ„ λ„μ¶ν•  μ μ—†λ‹¤.
<img src="/assets/images/springBoot/image00000012.png">
- κ°‘κ³Ό μ„μ κµμ‹  μƒν™©μ—μ„ κ°‘μ€ μ„μ—κ² μ „λ‹¬ν•κ³ μ ν•λ” μ›λ³Έκ³Ό κ·Έ μ›λ³Έμ λ©”μ‹μ§€ ν•΄μ‹ κ°’ κ·Έλ¦¬κ³  λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈ μ•κ³ λ¦¬μ¦μ„ λ³΄λ‚Έλ‹¤.
- μ„μ€ κ°‘μ΄ μ „λ‹¬ν• μ•κ³ λ¦¬μ¦κ³Ό μ›λ³Έμ„ κ°€μ§€κ³  λ©”μ‹μ§€ ν•΄μ‹ κ°’μ„ κ³„μ‚°ν•λ‹¤.
- μ„μ΄ κ³„μ‚°ν• λ©”μ‹μ§€ ν•΄μ‹ κ°’κ³Ό κ°‘μ΄ μ „λ‹¬ν• λ©”μ‹μ§€ ν•΄μ‹ κ°’μ΄ μΌμΉν•λ©΄, κ°‘μ΄ μ „λ‹¬ν• μ›λ³Έμ΄ λ„¤νΈμ›ν¬λ¥Ό ν†µν•΄ μ„μ—κ² μ¤κΈ°κΉμ§€ λ³€κ²½λμ§€ μ•μ•λ‹¤λ” κ²ƒμ„ ν™•μΈν•  μ μλ‹¤.

### β“ Signature
- Signatureλ” μ΄κΈ°ν™” μ‹ μ κ³µλ°›μ€ ν‚¤λ¥Ό μ‚¬μ©ν•΄μ„ λ°μ΄ν„°λ¥Ό μ„λ…ν•κ³  μ „μ μ„λ…μ μ ν¨μ„±μ„ κ²€μ¦ ν•λ”λ° μ‚¬μ©λλ‹¤.
<img src="/assets/images/springBoot/image00000013.png">

- **μ„λ…**
  - Signature κ°μ²΄λ” κ°μΈ ν‚¤λ΅ μ„λ… ν•κΈ° μ„ν•΄ μ΄κΈ°ν™”λκ³  μ„λ…ν•  μ›λ³Έ λ°μ΄ν„°κ°€ μ κ³µλλ‹¤.
  - Signature μ sign() μ€ κ°μΈ ν‚¤λ΅ μ›λ³Έ λ°μ΄ν„°λ¥Ό μ„λ… ν•λ©΄ ν•΄μ‹λ λ°μ΄ν„°λ¥Ό μ•”νΈν™”ν• Signature Bytes λ¥Ό λ°ν™ν•λ‹¤
  
- **κ²€μ¦**
  - κ²€μ¦μ΄ ν•„μ”ν• κ²½μ° κ²€μ¦μ„ μ„ν•΄ Signatureκ°μ²΄λ¥Ό μƒμ„± λ° μ΄κΈ°ν™”ν•κ³  κ°μΈν‚¤μ™€ μμ„ μ΄λ£¨λ” ν•΄λ‹Ή κ³µκ° ν‚¤λ¥Ό μ κ³µν•λ‹¤.
  - μ›λ³Έ λ°μ΄ν„°μ™€ Signature Bytes κ°€ κ²€μ¦ Signature κ°μ²΄μ— μ „λ‹¬λκ³  verify() λ¥Ό μ‹¤ν–‰ν•λ©΄ κ³µκ°ν‚¤λ΅ Signature Bytes μ ν•΄μ‹λ°μ΄ν„°λ¥Ό μ¶”μ¶ν•κ³  μ›λ³Έλ°μ΄ν„°λ¥Ό ν•΄μ‹ν• κ°’κ³Ό λΉ„κµν•΄μ„ μΌμΉν•λ©΄ Signature κ°μ²΄κ°€ μ„±κ³µμ„ λ³΄κ³ ν•λ‹¤.
<br/><br/>

- μ„λ…μ€ λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈμ™€ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”κ°€ κ²°ν•©ν• ν•νƒλ΅μ„ "SHA256WithRSAβ€ μ²λΌ λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈ μ•κ³ λ¦¬μ¦μΈ "SHA256"μ„ μ‚¬μ©ν•μ—¬ μ΄κΈ°μ— λ€κ·λ¨ λ°μ΄ν„°λ¥Ό λ³΄λ‹¤ κ΄€λ¦¬ν•κΈ° μ‰¬μ΄ κ³ μ •κΈΈμ΄μ ν•μ‹μΌλ΅ "μ••μ¶•"ν• λ‹¤μ λΉ„λ€μΉ­ν‚¤ μ•”νΈν™”μΈ "RSA" μ•κ³ λ¦¬μ¦μΌλ΅ κ³ μ •κΈΈμ΄μ 32λ°”μ΄νΈ λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈμ— μ„λ…ν•λ‹¤

### β“ JCA & JCE κµ¬μ΅°
- **Cipher**
  - μ•”νΈν™” λ° λ³µνΈν™”μ— μ‚¬μ©λλ” μ•”νΈν™” μ•”νΈμ κΈ°λ¥μ„ μ κ³µν•λ‹¤.
  - μ•”νΈν™”λ” μΌλ° ν…μ¤νΈμ™€ ν‚¤ λ¥Ό κ°€μ Έμ™€ μ•”νΈν™”λ λ°μ΄ν„°λ¥Ό μƒμ„±ν•λ” ν”„λ΅μ„Έμ¤μ„.
  - λ³µνΈν™”λ” μ•”νΈν™”λ λ°μ΄ν„°μ™€ ν‚¤λ¥Ό κ°€μ Έμ™€μ„ μΌλ° ν…μ¤νΈλ¥Ό μƒμ„±ν•λ” μ—­ κ³Όμ •μ΄λ‹¤.

  - **Cipher κ°μ²΄ μΈμ¤ν„΄μ¤ν™”ν•κΈ°**
    - μΈμ¤ν„΄μ¤ μƒμ„± μ‹ λ³€ν™μ„ μ§€μ •ν•λ”λ° λ³€ν™μ€ [μ•”νΈν™” μ•κ³ λ¦¬μ¦/ν”Όλ“λ°± λ¨λ“/ν¨λ”©] or [μ•”νΈν™” μ•κ³ λ¦¬μ¦] μΌλ΅ μ§€μ •ν•λ‹¤
      - Cipher c1 = Cipher.getInstance("RSA/ECB/OAEPWithSHA1AndMGF1Padding");
      - Cipher c1 = Cipher.getInstance("RSA");
<br/><br/>

  - **Cipher μ΄κΈ°ν™”ν•κΈ°**
    - Cipher κ°μ²΄λ¥Ό μ΄κΈ°ν™”ν•κΈ° μ„ν•΄μ„ Cipherμ μ‘λ™ λ¨λ“λ¥Ό λ‚νƒ€λ‚΄λ” opmode μ™€ Key λλ” μ¦λ…μ„(Certificate) λ¥Ό μΈμλ΅ μ „λ‹¬ν•κ³  init() λ©”μ„λ“λ¥Ό μ‹¤ν–‰ν•λ‹¤
    - opmode
      - ENCRYPT_MODE: cipher κ°μ²΄λ¥Ό μ•”νΈν™” λ¨λ“λ΅ μ΄κΈ°ν™”ν•λ‹¤.
      - DECRYPT_MODE: cipher κ°μ²΄λ¥Ό λ³µνΈν™” λ¨λ“λ΅ μ΄κΈ°ν™”ν•λ‹¤.
    - Cipher cipher = Cipher.getInstance("RSA");
    - cipher.init(Cipher.ENCRYPT_MODE, PrivateKey);
    <img src="/assets/images/springBoot/image00000014.png">

## 1-2. λ€μΉ­ν‚¤ & λΉ„λ€μΉ­ν‚¤

### β“ λ€μΉ­ν‚¤ μ•”νΈ(symmetric-key algorithm)
- μ•”νΈν™” μ•κ³ λ¦¬μ¦μ ν• μΆ…λ¥λ΅, μ•”νΈν™”μ™€ λ³µνΈν™”μ— κ°™μ€ μ•”νΈ ν‚¤λ¥Ό μ“°λ” μ•κ³ λ¦¬μ¦μ„ μλ―Έν•λ‹¤.
- λ€μΉ­ ν‚¤ μ•”νΈμ—μ„λ” μ•”νΈν™”λ¥Ό ν•λ” μΈ΅κ³Ό λ³µνΈν™”λ¥Ό ν•λ” μΈ΅μ΄ κ°™μ€ μ•”νΈ ν‚¤λ¥Ό κ³µμ ν•΄μ•Ό ν•λ‹¤.
- λΉ„λ€μΉ­ ν‚¤ μ•”νΈμ—μ„ κ³µκ° ν‚¤μ™€ λΉ„λ°€ ν‚¤λ¥Ό λ³„λ„λ΅ κ°€μ§€λ” κ²ƒκ³Ό κµ¬λ³„λλ©° λ€λ¶€λ¶„μ λ€μΉ­ ν‚¤ μ•”νΈλ” λΉ„λ€μΉ­ ν‚¤ μ•”νΈμ™€ λΉ„κµν•μ—¬ κ³„μ‚° μ†λ„κ°€ λΉ λ¥΄λ‹¤λ” μ¥μ μ„ κ°€μ§„λ‹¤.

- **MAC(Message Authentication Code)**
  - λ©”μ‹μ§€ μΈμ¦ μ½”λ“λ” λ°μ΄ν„°κ°€ λ³€μ΅°(μμ •, μ‚­μ , μ‚½μ… λ“±) λμ—λ”μ§€λ¥Ό <span style="color: red">κ²€μ¦</span>ν•  μ μλ„λ΅ λ°μ΄ν„°μ— λ§λ¶™μ΄λ” μ½”λ“
  - ν•΄μ‹ κ°’μ„ μƒμ„±ν•λ‹¤λ” μ μ—μ„ λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈμ™€ λΉ„μ·ν•μ§€λ§, μ΄κΈ°ν™” μ‹ λΉ„λ°€ν‚¤(SecretKey, λ€μΉ­ν‚¤)λ¥Ό μ”κµ¬ν•λ‹¤λ” μ μ—μ„ λ‹¤λ¥΄λ‹¤.
  - λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈλ” λ°›μ€ μΈ΅μ΄ λ„κµ¬λ“  λ¬΄κ²°μ„± κ²€μ‚¬κ°€ κ°€λ¥ν•μ§€λ§, MACμ€ μ¤μ§ λ™μΌν• λΉ„λ°€ ν‚¤λ¥Ό κ°€μ§„ μ½μ—μ„λ§ μ „λ‹¬λ°›μ€ λ©”μ‹μ§€μ λ¬΄κ²°μ„±μ„ κ²€μ‚¬ ν•  μ μλ‹¤.
  - μ•”νΈν™” ν•΄μ‹ ν•¨μ(MD5, SHA256 λ“±)λ¥Ό κΈ°λ°μΌλ΅ ν•λ” MACμ΄ μ μ•λ ¤μ§„ HMACμ΄λ‹¤.
  - HMACμ€ λ©”μ‹μ§€ λ‹¤μ΄μ μ¤νΈ μ•κ³ λ¦¬μ¦κ³Ό κ³µμ λ λΉ„λ°€ ν‚¤μ μ΅°ν•©μΌλ΅ κ°€λ¥ν•λ©° λ°μ΄ν„°μ λ¬΄κ²°μ„±κ³Ό κΈ°λ°€μ„±, μ†΅.μμ‹ μκ°„ μΈμ¦μ„ λ³΄μ¦ν•κΈ° μ„ν• μ•”νΈν™” κΈ°λ²•μ΄λ‹¤
  <img src="/assets/images/springBoot/image00000015.png">

### β“ λΉ„ λ€μΉ­ν‚¤ μ•”νΈ (asymmetric-key algorithm)
- μ•”νΈν™” μ•κ³ λ¦¬μ¦μ ν• μΆ…λ¥λ΅, μ•”νΈν™”μ™€ λ³µνΈν™”μ— λ‹¤λ¥Έ μ•”νΈ ν‚¤λ¥Ό μ“°λ” μ•κ³ λ¦¬μ¦μ„ μλ―Έν•λ‹¤.
- μ™Έλ¶€μ— μ λ€ λ…Έμ¶λμ–΄μ„λ” μ•λλ” κ°μΈν‚¤(Private key)μ™€ κ³µκ°μ μΌλ΅ κ°λ°©λμ–΄ μλ” κ³µκ°ν‚¤(Private key)λ¥Ό μμΌλ΅ μ΄λ£¬ ν•νƒμ΄λ‹¤
  - Aμ κ³µκ°ν‚¤λ¥Ό μ΄μ©ν•μ—¬ μ•”νΈν™”λ λ°μ΄ν„°λ” Aμ κ°μΈν‚¤λ΅λ§ λ³µνΈν™”κ°€ κ°€λ¥ν•λ‹¤.
  - Aμ κ°μΈν‚¤λ¥Ό μ΄μ©ν•μ—¬ μ•”νΈν™”λ λ°μ΄ν„°λ” Aμ κ³µκ°ν‚¤λ΅λ§ λ³µνΈν™”κ°€ κ°€λ¥ν•λ‹¤.
- λΉ„λ€μΉ­ν‚¤λ¥Ό μ‚¬μ©ν•μ—¬ λ‘κ°€μ§€ μ•”νΈν•™μ  λ¬Έμ λ¥Ό ν•΄κ²°ν•  μ μλ‹¤
  1. λ°μ΄ν„° λ³΄μ• : μ†΅μ‹ μ κ³µκ°ν‚¤λ΅ μ•”νΈν™” -> μ†΅μ‹ μ κ°μΈν‚¤λ΅ λ³µνΈν™”λ¥Ό ν†µν•΄ λ°μ΄ν„°λ¥Ό μ•μ „ν•κ² μ „μ†΅ν•  μ μλ” λ³΄μ• κ΄€μ 
  2. μΈμ¦ : μ†΅μ‹ μ κ°μΈν‚¤λ΅ μ•”νΈν™” -> μ†΅μ‹ μ κ³µκ°ν‚¤λ΅ λ³µνΈν™”λ¥Ό ν†µν•΄ λ©”μ‹μ§€λ¥Ό μΈμ¦(λ¶€μΈλ°©μ§€)ν•λ” κ²ƒμ΄ λ©μ 
<br/><br/>

- RSA (Ron <span style="color: red">R</span>ivest, Adi <span style="color: red">S</span>hamir, Leonard <span style="color: red">A</span>dleman μ„Έ μ‚¬λμ μ„±μ„ λ”°μ„ RSA λΌκ³  μ΄λ¦„μ΄ λ¶™μ€ μ•”νΈ λ°©μ‹)
  - ν„μ¬ SSL/TLSμ— κ°€μ¥ λ§μ΄ μ‚¬μ©λλ” κ³µκ°ν‚¤ μ•”νΈν™” μ•κ³ λ¦¬μ¦μΌλ΅ μ „μ„Έκ³„ λ€λ¶€λ¶„μ μΈν„°λ„· λ±…ν‚Ή(λ€ν•λ―Όκµ­ ν¬ν•¨)μ΄ μ΄ RSA-2048 μ•”νΈν™”λ¥Ό μ‚¬μ©ν•λ‹¤.
  <img src="/assets/images/springBoot/image00000016.png">

### β“ Key μƒμ„± λ¨λΈ
- **Key**
  - JCAμ—μ„ μ§€μ›ν•λ” λ¨λ“  μΆ…λ¥μ ν‚¤μ— λ€ν• μµμƒμ„ μΈν„°νμ΄μ¤
  - Key μΈν„°νμ΄μ¤λ” getAlgorithm(), getEncoded(), getFormat() μ μ„Έ κ°€μ§€ λ©”μ„λ“λ¥Ό μ κ³µν•λ‹¤
    - getAlgorithm() : ν‚¤ μ•κ³ λ¦¬μ¦μ€ λ³΄ν†µ λ€μΉ­ν‚¤ μ•”νΈ λ°©μ‹(AES,DSA λ“±) λλ” λΉ„λ€μΉ­ν‚¤ μ—°μ‚° μ•κ³ λ¦¬μ¦(RSA)μ΄λ‹¤.
    - getEncoded() : κΈ°λ³Έ μΈμ½”λ”©λ ν•μ‹μ ν‚¤λ¥Ό λ°ν™
    - getFormat() : μ΄ ν‚¤μ κΈ°λ³Έ μΈμ½”λ”© ν•μ‹μ μ΄λ¦„μ„ λ°ν™(ν‘μ¤€ν•μ‹μΈ X509 λλ” PKCS8)
- **KeyPair**
  - ν‚¤ μ(κ³µκ° ν‚¤μ™€ κ°μΈ ν‚¤)μ„ λ³΄κ΄€ν•κ³  μ ‘κ·Όν•  μ μλ” κΈ°λ¥λ§ μ κ³µν•λ‹¤
- **KeyPairGenerator**
  - κ³µκ° λ° κ°μΈ ν‚¤ μμ„ μƒμ„±ν•λ” λ° μ™„μ „ν μƒλ΅μ΄ κ°μ²΄λ¥Ό μƒμ„±ν•λ‹¤
- **KeyFactory**
  - μ–΄λ–¤ ν‚¤ λ°μ΄ν„° κ°μ²΄λ¥Ό λ‹¤λ¥Έ νƒ€μ…μ ν‚¤ λ°μ΄ν„° κ°μ²΄λ΅ μ „ν™ν•λ”λ° μ‚¬μ©ν•λ‹¤

### β“ Key κ³„μΈµ κµ¬μ΅°
<img src="/assets/images/springBoot/image00000017.png">

# 2. JWT (JSON Web Token)

## 2-1. μ†κ° λ° νΉμ§•

### β“ JOSE (JSON Object Signing and Encryption)
- **JSON λ°μ΄ν„°μ μ»¨ν…μΈ λ¥Ό μ•”νΈν™” λλ” μ„λ…μ ν•νƒλ΅ λ‚νƒ€λ‚΄κΈ° μ„ν•΄ IETFμ—μ„ ν‘μ¤€ν™” ν• μ†ν”„νΈμ›¨μ–΄ κΈ°μ  μ„ΈνΈ**
- **κΈ°μ μ—λ” λ‹¤μ μ‚¬μ–‘μ΄ ν¬ν•¨λλ‹¤**
  1. **JWT (JSON Web Token, RFC7519)**
    - ν΄λ μ„ κΈ°λ° λ³΄μ• κ°’μ„ λ‚νƒ€λ‚΄λ” λ°©λ²•μΌλ΅ λ‘ λ‹Ήμ‚¬μ κ°„μ— μ•μ „ν•κ² μ „λ‹¬λλ” ν΄λ μ„μ„ ν‘ν„ν•κΈ° μ„ν• κ°λ°©ν• ν‘μ¤€
    - JWTλ” μΈμ¦, κ¶ν• λ¶€μ—¬ λ° μ •λ³΄ κµν™μ— μ‚¬μ©λλ‹¤
    - JWS λλ” JWE λ°©μ‹μΌλ΅ κµ¬ν„λλ‹¤
  2. **JWS (JSON WEB SIGNITURE, RFC 7515)**
    - JSONμ„ μ‚¬μ©ν•μ—¬ λ””μ§€ν„Έ μ„λ… λλ” MACμΌλ΅ λ³΄μ•λ μ½ν…μΈ λ¥Ό ν‘ν„ν•λ” λ°©λ²•
  3. **JWE (JSON WEB ENCRYPTION, RFC 7516)**
    - JSONμ„ μ‚¬μ©ν•μ—¬ μλ„ν• μμ‹ μλ§ μ½μ„ μ μλ„λ΅ μ•”νΈν™”λ λ°μ΄ν„°(ν† ν°)λ¥Ό λ‚νƒ€λ‚΄λ” ν•μ‹
  4. **JWK (JSON WEB KEY, RFC 7517)**
    - HMAC μ΄λ‚ νƒ€μ› κ³΅μ„  λλ” RSA μ•κ³ λ¦¬μ¦μ„ μ‚¬μ©ν•μ—¬ κ³µκ° ν‚¤ μ„ΈνΈλ¥Ό JSON κ°μ²΄λ΅ λ‚νƒ€λ‚΄λ” JSON κµ¬μ΅°
  5. **JWA (JSON WEB ALGORITHM, RFC 7518)**
    - JWS, JWK λ° JWEμ— ν•„μ”ν• μ•κ³ λ¦¬μ¦ λ©λ΅μΌλ΅ JWS ν—¤λ” λ° JWS νμ΄λ΅λ“μ λ‚΄μ©μ„ μ„λ…ν•λ” λ° μ‚¬μ©λλ‹¤

<img src="/assets/images/springBoot/image00000018.png">

### β“ JWS κµ¬μ΅°
- **JOSE Header**
  - μΌλ°μ μΌλ΅ JWTμΈ ν† ν° μ ν•κ³Ό HMAC SHA256 λλ” RSA μ™€ κ°™μ€ μ„λ… μ•κ³ λ¦¬μ¦μ λ‘ λ¶€λ¶„μΌλ΅ κµ¬μ„±λλ‹¤
  - Base64Url λ΅ μΈμ½”λ”©λμ–΄ JSON μ›Ή ν† ν°μ μ²« λ²μ§Έ λ¶€λ¶„μ„ ν•μ„±ν•λ‹¤
- **Payload** (JWT Claim Set)
  - ν† ν°μ— ν¬ν•¨ν•  λ‚΄μ©μΈ ν΄λ μ„μ„ ν¬ν•¨ν•λ” νμ΄λ΅λ“λ΅μ„ ν‘μ¤€ ν•„λ“μΈ 7κ°μ λ“±λ΅ ν΄λ μ„ μ΄λ¦„(Registered Claim Names) λ° μ‚¬μ©μ μ§€μ • ν΄λ μ„ λ“±μΌλ΅ κµ¬μ„±ν•λ‹¤
  - Base64Url λ΅ μΈμ½”λ”©λμ–΄ JSON μ›Ή ν† ν°μ λ‘ λ²μ§Έ λ¶€λ¶„μ„ ν•μ„±ν•λ‹¤
- **Signiture**
  - μ„λ…μ€ Base64url μΈμ½”λ”©μ„ μ΄μ©ν•μ—¬ ν—¤λ”μ™€ νμ΄λ΅λ“λ¥Ό μΈμ½”λ”©ν•κ³  μ΄ λ‘μ„ μ (.) κµ¬λ¶„μλ΅ ν•¨κ» μ—°κ²°μ‹ν‚΄μΌλ΅μ¨ κ³„μ‚°λμ–΄ ν† ν°μ„ μ•μ „ν•κ² ν™•μΈν•λ‹¤.

<img src="/assets/images/springBoot/image00000019.png">

### β“ Claims
- **κ°λ…**
  - ν΄λ μ„(claim) μ€ μ£Όμ¥ν•κ³ μ ν•λ” μ •λ³΄λ¥Ό λ‚νƒ€λ‚΄λ” κ²ƒμΌλ΅ μ΄ μ •λ³΄λ¥Ό λ¨λ‘ κ°€μ§€κ³  μλ” λ°”λ”” λ¶€λ¶„μ„ Claim Set μ΄λΌκ³  λ¶€λ¥Έλ‹¤.
  - Claim Setμ€ ν‚¤ λ¶€λ¶„μΈ Claim Nameκ³Ό κ°’ λ¶€λ¶„μΈ Claim Valueμ μ—¬λ¬ μμΌλ΅ μ΄λ£¨μ–΄μ Έ μλ‹¤. 
  - JWT μ—λ” μ—¬λ¬κ°μ ν΄λ μ„λ“¤μ„ λ„£μ„ μ μλ‹¤

<img src="/assets/images/springBoot/image00000020.png">

### β“ JWT
<img src="/assets/images/springBoot/image00000021.png">
<img src="/assets/images/springBoot/image00000022.png">

### β“ λ°μ΄ν„° λ¬΄κ²°μ„±κ³Ό μ·¨μ•½μ 
1. Payload μ ν΄λ μ„ κ°’μ„ λ³€μ΅°ν•μ—¬ ν† ν°μ„ μƒμ„±ν• ν›„ μ „λ‹¬ν•λ”λΌλ„ μ„λ…μ—μ„ ν•΄μ‹λ κ°’κ³Ό λ³€μ΅°λ κ°’μ ν•΄μ‹λ κ°’μ΄ μ„λ΅ μΌμΉν•μ§€ μ•κΈ° λ•λ¬Έμ— κ²€μ¦μ΄ μ‹¤ν¨ν•μ—¬ λ°μ΄ν„°μ μ•μ „μ„±μ„ λ³΄μ¥ν•λ‹¤
2. SecretKey λ¥Ό νƒμ·¨λ‹Ήν–μ„ κ²½μ°μ—λ” μ¤‘μ”ν• μ •λ³΄κ°€ λ„λ‚λ‹Ήν•  μ μλ” μ·¨μ•½μ μ΄ λ°μƒν•κΈ° λ•λ¬Έμ— SecretKey λ¥Ό μ£ΌκΈ°μ μΌλ΅ λ³€κ²½ν•λ„λ΅ ν•λ” key rotation( key rolling) μ •μ±…μ΄ ν•„μ”ν•  μ μλ‹¤

## 2-2. JWK μ΄ν•΄

### β“ JWK κ°λ…
- μ•”νΈν™” ν‚¤λ¥Ό μ €μ¥ν•λ” λ°©μ‹μΌλ΅ μΈκ°€μ„λ²„μ—μ„ λ°ν–‰ν•λ” JWT ν† ν°μ μ•”νΈν™” λ° μ„λ…μ— ν•„μ”ν• μ•”νΈν™” ν‚¤μ λ‹¤μ–‘ν• μ •λ³΄λ¥Ό λ‹΄μ€ JSON κ°μ²΄ ν‘μ¤€μ΄λ‹¤
- JwkSetUri μ •λ³΄λ¥Ό μ„¤μ •ν•λ©΄ μΈκ°€μ„λ²„λ΅λ¶€ν„° JWK ν•νƒμ μ •λ³΄λ¥Ό λ‹¤μ΄λ΅λ“ν•  μ μκ³  JWT λ¥Ό κ²€μ¦ν•  μ μλ‹¤.

### β“ JWK κµ¬μ΅°
<img src="/assets/images/springBoot/image00000023.png">

### β“ JWK ν™•μ¥
- μλ°” ν‘μ¤€ λ³΄μ• ν΄λμ¤λ¥Ό μ‚¬μ©ν•μ—¬ λ€μΉ­ν‚¤, λΉ„λ€μΉ­ν‚¤ λ°©μ‹μ JWT μ μ•”νΈν™” λ° μ „μμ„λ…, μ΄ν›„ κ²€μ¦μ„ μ„ν• ν‚¤ μƒμ„±, λ³€ν™ λ“±μ„ μ§€μ›ν•λ‹¤
- κµ¬ν„μ²΄λ΅μ„ **RSAKey, OctetSequenceKey, ECKey, OctetKeyPair** κ°€ μλ‹¤
  <img src="/assets/images/springBoot/image00000024.png">

### β“ JWKGenerator<T extends JWK>
<img src="/assets/images/springBoot/image00000025.png">

- **μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ°©μ‹μ— λ”°λΌ JWK μ κµ¬ν„μ²΄κ°€ μκ³  κ° κµ¬ν„μ²΄λ¥Ό νΈλ¦¬ν•κ² μƒμ„±ν•  μ μλ” μ λ„λ μ΄ν„° ν΄λμ¤μ΄λ‹¤**
  - RSAKeyGenerator β€“ λΉ„λ€μΉ­ μ•”νΈν™” μ•κ³ λ¦¬μ¦ ν‚¤λ¥Ό ν¬ν•¨ν•λ” JWK μƒμ„±κΈ°
  - OctetSequenceKeyGenerator - λ€μΉ­ μ•”νΈν™” μ•κ³ λ¦¬μ¦ ν‚¤λ¥Ό ν¬ν•¨ν•λ” JWK μƒμ„±κΈ°
  - EcKeyGenerator - νƒ€μ›κ³΅μ„  μ•”νΈν™” μ•κ³ λ¦¬μ¦ ν‚¤ ν¬ν•¨ν•λ” JWK μƒμ„±κΈ°

# 3. OAuth2 MAC & RSA κ²€μ¦

## 3-1. κΈ°λ³Έ ν™κ²½ λ° κ³µν†µ ν΄λμ¤ κµ¬μ„±

### β“ ν† ν° κ²€μ¦ λ°©λ²•
- **ν† ν° κ²€μ¦μ— λ€ν• λ‹¤μ–‘ν• μΌ€μ΄μ¤μ ν…μ¤νΈλ¥Ό μ„ν•΄ λ‘ κ°€μ§€ λ°©μ‹μΌλ΅ ν† ν° λ°ν–‰ λ° κ²€μ¦μ„ μ§„ν–‰ν•λ„λ΅ ν•λ‹¤.**<br/>
  β‘  μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ°©μ‹μ— λ”°λΌ μ§μ ‘ λ°ν–‰ν• JWT ν† ν°μ„ λ€μƒμΌλ΅ κ²€μ¦μ„ μ§„ν–‰ν•λ‹¤<br/>
  β‘΅ μΈκ°€ μ„λ²„μ—μ„ λ°ν–‰ν• Access Token μ„ λ€μƒμΌλ΅ κ²€μ¦μ„ μ§„ν–‰ν•λ‹¤<br/>

  β“ JwtDecoder λΉμ€ μ•”νΈν™” μ•κ³ λ¦¬μ¦ λ° νΉμ •ν• μ΅°κ±΄μ— λ”°λΌ κ° μƒμ„±λλ©° λ””μ½”λ”©μ΄ μ§„ν–‰λλ©΄ μ£Όμ–΄μ§„ μ•κ³ λ¦¬μ¦μ— μν•΄ κ²€μ¦ν•κ² λλ‹¤
  <img src="/assets/images/springBoot/image00000026.png">

### β“ ν† ν° κ²€μ¦ ν…μ¤νΈ
1. **MAC λ°©μ‹μ— μν• κ²€μ¦ ν…μ¤νΈ**<br/>
   β‘  μμ²΄ ν† ν° λ°ν–‰ λ° κ²€μ¦<br/>
   β‘΅ SecretKey μ„¤μ •μ— μν• κ²€μ¦<br/>
2. **RSA λ°©μ‹μ— μν• κ²€μ¦ ν…μ¤νΈ**<br/>
   β‘  μμ²΄ ν† ν° λ°ν–‰ λ° κ²€μ¦<br/>
   β‘΅ JwtDecoder μ— μν• κ²€μ¦<br/>
   β‘Ά KeyStore ν΄μ— μν• κ²€μ¦<br/>
   β‘£ JwkSetUri μ„¤μ •μ— μν• κ²€μ¦<br/>

### β“ ν¨ν‚¤μ§€ κµ¬μ„±
- io.oauth2.resourceserver.configs β€“ μ„¤μ •ν΄λμ¤
- Io.oauth2.resourceserver.filter.authentication β€“ μΈμ¦ν•„ν„°(ν† ν° λ°ν–‰ λ‹΄λ‹Ή)
- Io.oauth2.resourceserver.filter.authorization β€“ μΈκ°€ν•„ν„°(ν† ν° κ²€μ¦ λ‹΄λ‹Ή)
- Io.oauth2.resourceserver.signature β€“ ν† ν° μ„λ… λ° λ°ν–‰
- Io.oauth2.resourceserver.controller β€“ μ»¨νΈλ΅¤λ¬
- io.oauth2.resourceserver.dto β€“ μ”μ²­ νλΌλ―Έν„° κ°μ²΄
- io.oauth2.resourceserver.init β€“ μ΄κΈ°ν™” μ‘μ—…

### β“ κΈ°λ³Έ ν΄λμ¤ μƒμ„±
- OAuth2ResourceServer β€“ λ¦¬μ†μ¤ μ„λ²„ μ„¤μ •ν΄λμ¤
- IndexController β€“ μ»¨νΈλ΅¤λ¬

### β“ ν™κ²½μ„¤μ •
- application.yml

### β“ μμ΅΄μ„± μ¶”κ°€
- gradle

### β“ SignatureConfig
- μ„λ…κ³Ό κ²€μ¦, MAC λ° RSA μ•”νΈν™” JWK λ“±μ λΉλ“¤μ„ μƒμ„±ν•λ” μ„¤μ • ν΄λμ¤

### β“ JwtAuthenticationFilter
- μΈκ°€μ„λ²„λ¥Ό λ€μ‹ ν•μ—¬ ν† ν°μ„ λ°ν–‰ν•λ” μ»¤μ¤ν…€ ν•„ν„°λ΅μ„ UsernamePasswordAuthenticationFilter λ¥Ό μƒμ†ν•λ‹¤
- POST /login μ”μ²­μ— λ€ν•΄ μΈμ¦ μ²λ¦¬λ¥Ό λ‹΄λ‹Ήν•λ‹¤
- μΈμ¦μ— μ„±κ³µν•κ² λλ©΄ SecuritySigner λ¥Ό νΈμ¶ν•΄μ„ JWT ν† ν°μ„ μƒμ„±ν•κ³  ν΄λΌμ΄μ–ΈνΈμ—κ² μ‘λ‹µν•λ‹¤
- MAC κ³Ό RSA μ μ„λ… λ° μΈμ¦μ— κ³µν†µμΌλ΅ μ‚¬μ©ν•λ” ν•„ν„°

### β“ SecuritySigner
- MAC λ° RSA μ•”νΈν™” λ°©μ‹μ— λ”°λΌ ν† ν°μ„ λ°ν–‰ν•λ” μ¶”μƒ ν΄λμ¤

## 3-2. MAC κ²€μ¦ κΈ°λ¥ κµ¬ν„

### 3-2-1. JwtAuthorizationMacFilter μ— μν• κ²€μ¦
<img src="/assets/images/springBoot/image00000027.png">

**β“ OAuth2ResourceServer**
```java
@Bean //λ¦¬μ†μ¤ μ„λ²„ μ„¤μ • ν΄λμ¤λ΅μ„ MAC μΈμ¦ λ° μΈκ°€ μ²λ¦¬ μ„¤μ •μ„ ν•λ‹¤
SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
  http.csrf().disable();
  http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);

  http.authorizeRequests((requests) -> requests.antMatchers("/login","/").permitAll().anyRequest().authenticated());
  http.userDetailsService(getUserDetailsService());
  http.addFilterBefore(jwtAuthenticationFilter(macSecuritySigner, octetSequenceKey), UsernamePasswordAuthenticationFilter.class);
  http.addFilterBefore(jwtAuthorizationMacFilter(octetSequenceKey), UsernamePasswordAuthenticationFilter.class);

  return http.build();
}
```

**β“ JwtAuthorizationMacFilter**
- Bearer ν† ν°μ„ MAC μ•κ³ λ¦¬μ¦μ— μν•΄ κ²€μ¦ν•λ©° κ²€μ¦ μ„±κ³µμ‹ μΈμ¦ λ° μΈκ°€λ¥Ό μ²λ¦¬ν•λ” ν•„ν„°

**β“ MacSecuritySinger**
- SecuritySigner μ„ μƒμ†λ°›μΌλ©° MAC κΈ°λ° μ„λ… λ° ν† ν°μ„ λ°ν–‰ν•λ” ν΄λμ¤

### 3-2-2. JwtDecoder μ— μν• κ²€μ¦
**β“ JwtDecoderConfig**
- SecretKey κΈ°λ° JwtDecoder μƒμ„±
- λ€μΉ­ν‚¤ λ°©μ‹μΌλ΅ μƒμ„±λ ν† ν°μ„ κ²€μ¦ν•κΈ° μ„ν•΄ JWK λ¥Ό μƒμ†ν• OctetSequenceKey λ΅ SecretKey κΈ°λ° JwtDecoder λ¥Ό μƒμ„±ν•λ‹¤

```java
@Bean
@ConditionalOnProperty(prefix = "spring.security.oauth2.resourceserver.jwt", name = "jws-algorithms", havingValue = "HS256", matchIfMissing = false)
public JwtDecoder jwtDecoderBySecretKeyValue(OctetSequenceKey octetSequenceKey,OAuth2ResourceServerProperties properties) {
  return NimbusJwtDecoder.withSecretKey(octetSequenceKey.toSecretKey())
        .macAlgorithm(MacAlgorithm.from(properties.getJwt().getJwsAlgorithms().get(0)))
        .build();
}
```

**β“ application.yml**
```yaml
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jws-algorithms: HS256
```

## 3-3. RSA κ²€μ¦ κΈ°λ¥ κµ¬ν„

### 3-3-1. JwtAuthorizationRsaFilter μ— μν• κ²€μ¦
**β“ OAuth2ResourceServer**
```java
@Bean //λ¦¬μ†μ¤ μ„λ²„ μ„¤μ • ν΄λμ¤λ΅μ„ MAC μΈμ¦ λ° μΈκ°€ μ²λ¦¬ μ„¤μ •μ„ ν•λ‹¤
SecurityFilterChain securityFilterChain(HttpSecurity http) throws Exception {
  http.csrf().disable();
  http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);

  http.authorizeRequests((requests) -> requests.antMatchers("/").permitAll().anyRequest().authenticated());
  http.userDetailsService(getUserDetailsService());
  http.addFilterBefore(jwtAuthenticationFilter(rsaSecuritySigner, rsaKey), UsernamePasswordAuthenticationFilter.class);
  http.addFilterBefore(jwtAuthorizationRsaFilter(rsaKey), UsernamePasswordAuthenticationFilter.class);

  return http.build();
}
```

**β“ JwtAuthorizationRsaFilter**
- Bearer ν† ν°μ„ RSA μ•κ³ λ¦¬μ¦μ— μν•΄ κ²€μ¦ν•λ©° κ²€μ¦ μ„±κ³µμ‹ μΈμ¦ λ° μΈκ°€λ¥Ό μ²λ¦¬ν•λ” ν•„ν„°

**β“ RsaSecuritySinger**
- SecuritySigner μ„ μƒμ†λ°›μΌλ©° RSA κΈ°λ° μ„λ… λ° ν† ν°μ„ λ°ν–‰ν•λ” ν΄λμ¤

### 3-3-2. JwtDecoder μ— μν• κ²€μ¦
**β“ JwtDecoderConfig**
- PublicKey κΈ°λ° JwtDecoder μƒμ„±
- λΉ„λ€μΉ­ν‚¤ λ°©μ‹μΌλ΅ μƒμ„±λ ν† ν°μ„ κ²€μ¦ν•κΈ° μ„ν•΄ JWK λ¥Ό μƒμ†ν• RSAKey λ΅ PublicKey κΈ°λ° JwtDecoder λ¥Ό μƒμ„±ν•λ‹¤

```java
@Bean
@ConditionalOnProperty(prefix = "spring.security.oauth2.resourceserver.jwt", name = "jws-algorithms", havingValue = "RS512", matchIfMissing = false)
public JwtDecoder jwtDecoderByPublicKeyValue(RSAKey rsaKey, OAuth2ResourceServerProperties properties) throws JOSEException {
  return NimbusJwtDecoder.withPublicKey(rsaKey.toRSAPublicKey())
        .signatureAlgorithm(SignatureAlgorithm.from(properties.getJwt().getJwsAlgorithms().get(0)))
        .build();
}
```

**β“ application.yml**
```yaml
spring:
  security:
    oauth2:
      resourceserver:
        jwt:
          jws-algorithms: RS512
```

### 3-3-3. KeyStore μ— μν• κ²€μ¦
**β“ KeyStore ν΄λμ¤**
- Java λ” KeyStore λΌλ” μΈν„°νμ΄μ¤λ¥Ό ν†µν•΄ μ•”νΈν™”/λ³µνΈν™” λ° μ „μ μ„λ…μ— μ‚¬μ©λλ” Private Key, Public Key μ™€ Certificate λ¥Ό μ¶”μƒν™”ν•μ—¬ μ κ³µν•κ³  μλ‹¤
- KeyStore μ—λ” SecretKey, Private Key, Public Key, Certificate μ™€ κ°™μ€ λ³΄μ• νμΌλ“¤μ΄ μ €μ¥λλ©° KeyStore λ” νμΌ μ‹μ¤ν…μ— μ €μ¥ν•κ³  μ•”νΈλ΅ λ³΄νΈν•  μ μλ‹¤
- KeyStore λ” keytool μ‚¬μ©ν•΄μ„ μƒμ„±ν•  μ μμΌλ©° κΈ°λ³Έ νƒ€μ…μ€ jks μ΄λ‹¤

**β“ keytool**
- keytool μ€ μλ°”μ—μ„ μ κ³µν•λ” μ ν‹Έλ¦¬ν‹°λ΅ KeyStore κΈ°λ°μΌλ΅ μΈμ¦μ„μ™€ ν‚¤λ¥Ό κ΄€λ¦¬ν•  μ μμΌλ©° JDK μ— ν¬ν•¨λμ–΄ μλ‹¤.
  - C:\Program Files\Java\jdk-11.0.11\bin\keytool.exe
- Keystore μƒμ„± ν›„ PrivateKey, PublicKey, Certificate μƒμ„±
  - Private key μƒμ„± : keytool -genkeypair -alias apiKey -keyalg RSA -keypass "pass1234" -keystore apiKey.jks -storepass "pass1234"
  - Certificate μƒμ„± : keytool -export -alias apiKey -keystore apiKey.jks -rfc -file trustServer.cer
  - Public key μƒμ„± : keytool -import -alias trustServer -file trustServer.cer -keystore publicKey.jks

**β“ μμ„**
1. **KeyStore μ κ°μ²΄λ¥Ό μ–»λ”λ‹¤**
   - keytool μ„ ν†µν•΄ μ–»μ€ apiKey.jks νμΌμ„ μ½μ–΄μ¤λ©΄ ν‚¤μ™€ μΈμ¦μ„λ¥Ό κ°€μ Έ μ¬ μ μμΌλ©° μ—¬κΈ°μ—λ” κ°μΈν‚¤μ™€ μΈμ¦μ„, κ³µκ°ν‚¤ μ •λ³΄λ¥Ό λ‹΄κ³  μλ‹¤
     - KeyStore keystore = KeyStore.getInstance(KeyStore.getDefaultType()) // κΈ°λ³Έ νƒ€μ…μ€ .jks( java key store)
     - keystore.load(new FileInputStream(β€/certs/apiKey.jks)β€, keystorepassword.toCharArray()); // κΈ°μ΅΄ ν‚¤ μ €μ¥μ†λ¥Ό load ν•λ‹¤
2. **κ°μΈ ν‚¤λ¥Ό μ–»λ”λ‹¤**
   - PrivateKey key = (PrivateKey) keystore.getKey(alias, "test1234".toCharArray());
3. **μΈμ¦μ„λ¥Ό μ–»λ”λ‹¤**
   - Certificate certificate = keystore.getCertificate(alias);
4. **μΈμ¦μ„λ΅λ¶€ν„° κ³µκ° ν‚¤λ¥Ό μ–»κ³  Base64 λ΅ μΈμ½”λ”©ν• λ‹¤μ λ¬Έμμ—΄μ„ λ³€ν™ν•λ‹¤**
   - PublicKey publicKey = certificate.getPublicKey();
   - String publicStr = java.util.Base64.getMimeEncoder().encodeToString(publicKey.getEncoded());
5. **μΈμ½”λ”©λ κ³µκ° ν‚¤ λ¬Έμμ—΄μ„ txt νμΌλ΅ μ €μ¥ν•λ‹¤**
   - OutputStreamWriter writer = new OutputStreamWriter(new FileOutputStream(β€/certs/publicKey.txt"), Charset.defaultCharset());
   - writer.write(publicStr);
   - writer.close();

**β“ JwtDecoderConfig**
```java
@Bean
@Conditional(KeyValueCondition.class)
JwtDecoder jwtDecoderByPublicKeyValue() throws Exception {
  RSAPublicKey publicKey = (RSAPublicKey) KeyFactory.getInstance("RSA").generatePublic(new X509EncodedKeySpec(getKeySpec(this.properties.readPublicKey())));
  NimbusJwtDecoder jwtDecoder = 
      NimbusJwtDecoder.withPublicKey(publicKey).signatureAlgorithm(SignatureAlgorithm.from(this.properties.getJwsAlgorithm())).build();
  jwtDecoder.setJwtValidator(getValidators(JwtValidators::createDefault));

  return jwtDecoder;
}
```

**β“ OAuth2ResourceServer**
- λ¦¬μ†μ¤ μ„λ²„ μ„¤μ • ν΄λμ¤λ΅μ„ KeyStore μ—μ„ μ¶”μ¶ν• PublicKey μ— μν•΄ RSA μΈμ¦ λ° μΈκ°€ μ²λ¦¬ μ„¤μ •μ„ ν•λ‹¤

**β“ RsaPublicKeySecuritySigner**
- SecuritySigner μ„ μƒμ†λ°›μΌλ©° RSA μ•”νΈν™” λ°©μ‹μ μ„λ… λ° ν† ν° λ°ν–‰

**β“ RsaKeyExtractor**
- apiKey.jks λ΅ λ¶€ν„° PrivateKey μ™€ PublicKey λ¥Ό μ¶”μ¶ν•κ³  νμΌμ— μ €μ¥ν•λ” ν΄λμ¤

### 3-3-4. JwkSetUri μ— μν• κ²€μ¦
**β“ SecurityJwkSetUriResourceServerConfig**
```java
@Bean
@ConditionalOnProperty(name = "spring.security.oauth2.resourceserver.jwt.jwk-set-uri")
JwtDecoder jwtDecoderByJwkKeySetUri() {
  NimbusJwtDecoder nimbusJwtDecoder = 
  NimbusJwtDecoder.withJwkSetUri(this.properties.getJwkSetUri()).jwsAlgorithm(SignatureAlgorithm.from(this.properties.getJwsAlgorithm())).build();
  String issuerUri = this.properties.getIssuerUri();
  Supplier<OAuth2TokenValidator<Jwt>> defaultValidator = (issuerUri != null) ? () -> JwtValidators.createDefaultWithIssuer(issuerUri) : JwtValidators::createDefault;
  nimbusJwtDecoder.setJwtValidator(getValidators(defaultValidator));

  return nimbusJwtDecoder;
}
```

**β“ OAuth2ResourceServer**
- λ¦¬μ†μ¤ μ„λ²„ μ„¤μ • ν΄λμ¤λ΅μ„ μΈκ°€μ„λ²„ μ—”λ“ν¬μΈνΈμΈ JwkSetUri λ°©μ‹μ— μν• RSA μΈμ¦ λ° μΈκ°€ μ²λ¦¬ μ„¤μ •μ„ ν•λ‹¤
  <img src="/assets/images/springBoot/image00000028.png">

# 4. Authentication / @AuthenticationPrincipal

## β“ Authentication
- λ¦¬μ†μ¤ μ„λ²„μ—μ„ ν† ν° κ²€μ¦μ΄ μ΄λ£¨μ–΄μ§€λ©΄ ν† ν°μΌλ΅ λ¶€ν„° μ •λ³΄λ¥Ό μ¶”μ¶ν•΄μ„ μΈμ¦κ°μ²΄λ¥Ό κµ¬μ„±ν•κ² λλ‹¤
- μ¤ν”„λ§ μ‹νλ¦¬ν‹°μ μμ›μ— λ€ν• μ ‘κ·Όμ€ μΈμ¦κ°μ²΄μ μΈμ¦ μ λ¬΄μ™€ κ¶ν•μ •λ³΄μ— λ”°λΌ κ²°μ •λκΈ° λ•λ¬Έμ— μΈμ¦κ°μ²΄λ¥Ό μƒμ„±ν•΄μ•Ό ν•λ‹¤
- μΈμ¦ κ°μ²΄λ” JwtAuthenticationToken νƒ€μ…μΌλ΅ μƒμ„±λκ³  SecurityContext μ— μ €μ¥ν•λ‹¤

## β“ Jwt
- JwtDecoder λ” κ²€μ¦μ΄ μ„±κ³µν•λ©΄ ν† ν°μ ν΄λ μ„μΌλ΅λ¶€ν„° μ •λ³΄λ¥Ό μ¶”μ¶ν•΄μ„ μµμΆ… Jwt κ°μ²΄λ¥Ό λ°ν™ν•λ‹¤
- Jwt κ°μ²΄λ” JwtAuthenticationToken μ principal μ†μ„±μ— μ €μ¥λλ‹¤

## β“ @AuthenticationPrincipal
- JwtAuthenticationToken μ principal μ— μ €μ¥λμ–΄ μλ” Jwt κ°μ²΄λ¥Ό λ°”λ΅ μ°Έμ΅°ν•  μ μλ‹¤
  <img src="/assets/images/springBoot/image00000029.png">

# 5. BearerTokenAuthenticationFilter
<img src="/assets/images/springBoot/image00000030.png">
