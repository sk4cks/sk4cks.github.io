---
layout: single
title: "ğŸ” CORS ì´í•´"
categories:
  - springBoot
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "sidebar-category"
---

# ê°œë… ì„¤ëª… ë° API

## CORS(Cross-Origin Resource Sharing, êµì°¨ ì¶œì²˜ ë¦¬ì†ŒìŠ¤ ê³µìœ )

- HTTP í—¤ë”ë¥¼ ì‚¬ìš©í•˜ì—¬, í•œ ì¶œì²˜ì—ì„œ ì‹¤í–‰ ì¤‘ì¸ ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë‹¤ë¥¸ ì¶œì²˜ì˜ ì„ íƒí•œ ìì›ì— ì ‘ê·¼í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì„ ë¶€ì—¬í•˜ë„ë¡ ë¸Œë¼ìš°ì €ì— ì•Œë ¤ì£¼ëŠ” ì²´ì œ
- ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ë¦¬ì†ŒìŠ¤ê°€ ìì‹ ì˜ ì¶œì²˜ì™€ ë‹¤ë¥¼ ë•Œ ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ í—¤ë”ì— Origin í•„ë“œì— ìš”ì²­ ì¶œì²˜ë¥¼ í•¨ê»˜ ë‹´ì•„ êµì°¨ ì¶œì²˜ HTTP ìš”ì²­ì„ ì‹¤í–‰í•œë‹¤.
- ì¶œì²˜ë¥¼ ë¹„êµí•˜ëŠ” ë¡œì§ì€ ì„œë²„ì— êµ¬í˜„ëœ ìŠ¤í™ì´ ì•„ë‹Œ ë¸Œë¼ìš°ì €ì— êµ¬í˜„ëœ ìŠ¤í™ ê¸°ì¤€ìœ¼ë¡œ ì²˜ë¦¬ë˜ë©° ë¸Œë¼ìš°ì €ëŠ” í´ë¼ì´ì–¸íŠ¸ì˜ ìš”ì²­ í—¤ë”ì™€ ì„œë²„ì˜ ì‘ë‹µí—¤ë”ë¥¼ ë¹„êµí•´ì„œ ìµœì¢… ì‘ë‹µì„ ê²°ì •í•œë‹¤.
- ë‘ê°œì˜ ì¶œì²˜ë¥¼ ë¹„êµí•˜ëŠ” ë°©ë²•ì€ URLì˜ êµ¬ì„±ìš”ì†Œ ì¤‘ Protocol, Host, Port ì´ ì„¸ê°€ì§€ê°€ ë™ì¼í•œì§€ í™•ì¸í•˜ë©´ ë˜ê³  ë‚˜ë¨¸ì§€ëŠ” í‹€ë ¤ë„ ìƒê´€ì—†ë‹¤.

![image](https://github.com/user-attachments/assets/ed96bbfd-cd9b-42f9-95c9-8b32e24d53cc)

- https://domain-a.com ì˜ í”„ë¡ íŠ¸ ì—”ë“œ JavaScript ì½”ë“œê°€ XMLHttpRequestë¥¼ ì‚¬ìš©í•˜ì—¬ https://domain-b.com/data.jsonì„ ìš”ì²­í•˜ëŠ” ê²½ìš° ë³´ì•ˆ ìƒì˜ ì´ìœ ë¡œ, ë¸Œë¼ìš°ì €ëŠ” ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ì‹œì‘í•œ êµì°¨ ì¶œì²˜ HTTP ìš”ì²­ì„ ì œí•œí•œë‹¤.
  ![image](https://github.com/user-attachments/assets/087f61be-593b-4ea3-bbc4-ae7673fefe51)
- XMLHttpRequestì™€ Fetch APIëŠ” ë™ì¼ ì¶œì²˜ ì •ì±…ì„ ë”°ë¥´ê¸° ë•Œë¬¸ì— ì´ APIë¥¼ ì‚¬ìš©í•˜ëŠ” ì›¹ ì• í”Œë¦¬ì¼€ì´ì…˜ì€ ìì‹ ì˜ ì¶œì²˜ì™€ ë™ì¼í•œ ë¦¬ì†ŒìŠ¤ë§Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆìœ¼ë©°, ë‹¤ë¥¸ ì¶œì²˜ì˜ ë¦¬ì†ŒìŠ¤ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ ê·¸ ì¶œì²˜ì—ì„œ ì˜¬ë°”ë¥¸ CORS í—¤ë”ë¥¼ í¬í•¨í•œ ì‘ë‹µì„ ë°˜í™˜í•´ì•¼í•œë‹¤.

## ë™ì¼ ì¶œì²˜ ê¸°ì¤€

![image](https://github.com/user-attachments/assets/de647c82-6ce2-4aca-85c3-424e615f10aa)

## CORS í•´ê²° - ì„œë²„ì—ì„œ Access-Control-Allow-\* ì„¸íŒ…

- `Access-Control-Allow-Origin` - í—¤ë”ì— ì‘ì„±ëœ ì¶œì²˜ë§Œ ë¸Œë¼ìš°ì €ê°€ ë¦¬ì†ŒìŠ¤ë¥¼ ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ í—ˆìš©í•œë‹¤
  - \*, https://security.io
- `Access-Control-Allow-Methods` - preflight request ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì‹¤ì œ ìš”ì²­ ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œë¥¼ ë‚˜íƒ€ë‚¸ë‹¤
  - ê¸°ë³¸ê°’ì€ GET,POST,HEAD,OPTIONS, \*
- `Access-Control-Allow-Headers` - preflight request ì— ëŒ€í•œ ì‘ë‹µìœ¼ë¡œ ì‹¤ì œ ìš”ì²­ ì¤‘ì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” í—¤ë” í•„ë“œ ì´ë¦„ì„ ë‚˜íƒ€ë‚¸ë‹¤
  - ê¸°ë³¸ê°’ì€ Origin,Accept,X-Requested-With,Content-Type, Access-Control-Request-Method,Access-Control-Request-Headers, Custom Header, \*
- `Access-Control-Allow-Credentials` - ì‹¤ì œ ìš”ì²­ì— ì¿ í‚¤ë‚˜ ì¸ì¦ ë“±ì˜ ì‚¬ìš©ì ìê²© ì¦ëª…ì´ í¬í•¨ë  ìˆ˜ ìˆìŒì„ ë‚˜íƒ€ë‚¸ë‹¤. Clientì˜ credentials:include ì¼ê²½ìš° true í•„ìˆ˜
- `Access-Control-Max-Age` - preflight ìš”ì²­ ê²°ê³¼ë¥¼ ìºì‹œ í•  ìˆ˜ ìˆëŠ” ì‹œê°„ì„ ë‚˜íƒ€ë‚´ëŠ” ê²ƒìœ¼ë¡œ í•´ë‹¹ ì‹œê°„ë™ì•ˆì€ preflightìš”ì²­ì„ ë‹¤ì‹œ í•˜ì§€ ì•Šê²Œ ëœë‹¤

## CorsConfigurer

- Spring Security í•„í„° ì²´ì¸ì— CorsFilterë¥¼ ì¶”ê°€í•©ë‹ˆë‹¤.
- corsFilter ë¼ëŠ” ì´ë¦„ì˜ Beanì´ ì œê³µë˜ë©´ í•´ë‹¹ CorsFilterê°€ ì‚¬ìš©ëœë‹¤
- corsFilter ë¼ëŠ” ì´ë¦„ì˜ Beanì´ ì—†ê³  CorsConfigurationSource ë¹ˆì´ ì •ì˜ëœ ê²½ìš° í•´ë‹¹ CorsConfigurationì´ ì‚¬ìš©ëœë‹¤.
- CorsConfigurationSource ë¹ˆì´ ì •ì˜ë˜ì–´ ìˆì§€ ì•Šì€ ê²½ìš° Spring MVCê°€ í´ë˜ìŠ¤ ê²½ë¡œì— ìˆìœ¼ë©´ HandlerMappingIntrospectorê°€ ì‚¬ìš©ëœë‹¤.

## CorsFilter

- CORS ì˜ˆë¹„ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  CORS ë‹¨ìˆœ ë° ë³¸ ìš”ì²­ì„ ê°€ë¡œì±„ê³ , ì œê³µëœ CorsConfigurationSource ë¥¼ í†µí•´ ì¼ì¹˜ëœ ì •ì±…ì— ë”°ë¼ CORS ì‘ë‹µ í—¤ë”ì™€ ê°™ì€ ì‘ë‹µì„ ì—…ë°ì´íŠ¸í•˜ê¸° ìœ„í•œ í•„í„°ì´ë‹¤
- Spring MVC Java êµ¬ì„±ê³¼ Spring MVC XML ë„¤ì„ìŠ¤í˜ì´ìŠ¤ì—ì„œ CORSë¥¼ êµ¬ì„±í•˜ëŠ” ëŒ€ì•ˆì´ë¼ ë³¼ ìˆ˜ ìˆë‹¤ ( ì˜ˆ: @CorsOrigin)
- ìŠ¤í”„ë§ ì›¹ì— ì˜ì¡´í•˜ëŠ” ì‘ìš© í”„ë¡œê·¸ë¨ì´ë‚˜ javax.servlet ì—ì„œ CORS ê²€ì‚¬ë¥¼ ìˆ˜í–‰í•´ì•¼ í•˜ëŠ” ë³´ì•ˆ ì œì•½ ì¡°ê±´ì— ìœ ìš©í•œ í•„í„°ì´ë‹¤

<br/>

```java
@Override
protected void configure(final HttpSecurity http) throws Exception {
	http
		.authorizeRequests()
		.anyRequest().authenticated()
		.and();

    http.cors().configurationSource(corsConfigurationSource()); // CorsConfigurer ì„¤ì •ì„ ì´ˆê¸°í™” í•œë‹¤

}

@Bean
public CorsConfigurationSource corsConfigurationSource() {
CorsConfiguration configuration = new CorsConfiguration();

    configuration.addAllowedOrigin("*");
    configuration.addAllowedMethod("*");
    configuration.addAllowedHeader("*");
    configuration.setAllowCredentials(true);
    configuration.setMaxAge(3600L);
    UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource();
    source.registerCorsConfiguration("/**", configuration);

    return source;

}

```

<br/>

# CORS ìš”ì²­ì˜ ì¢…ë¥˜

## Simple Request

- Simple Request ëŠ” ì˜ˆë¹„ ìš”ì²­(Prefilght)ì„ ê³¼ì • ì—†ì´ ë°”ë¡œ ì„œë²„ì— ë³¸ ìš”ì²­ì„ í•œ í›„, ì„œë²„ê°€ ì‘ë‹µì˜ í—¤ë”ì— Access-Control-Allow-Origin ê³¼ ê°™ì€ ê°’ì„ ì „ì†¡í•˜ë©´ ë¸Œë¼ìš°ì €ê°€ ì„œë¡œ ë¹„êµ í›„ CORS ì •ì±… ìœ„ë°˜ì—¬ë¶€ë¥¼ ê²€ì‚¬í•˜ëŠ” ë°©ì‹ì´ë‹¤
- <b>ì œì•½ì‚¬í•­</b>
  - GET, POST, HEAD ì¤‘ì˜ í•œê°€ì§€ Methodë¥¼ ì‚¬ìš©í•´ì•¼ í•œë‹¤
  - í—¤ë”ëŠ” Accept, Accept-Language, Content-Language, Content-Type, DPR, Downlink, Save-Data, Viewport-Width Width ë§Œ ê°€ëŠ¥í•˜ê³  Custom Header ëŠ” í—ˆìš©ë˜ì§€ ì•ŠëŠ”ë‹¤
  - Content-type ì€ application/x-www-form-urlencoded, multipart/form-data, text/plain ë§Œ ê°€ëŠ¥í•˜ë‹¤

![image](https://github.com/user-attachments/assets/5fb4f885-c047-4ab6-b712-fb20bd975e32)

## Preflight Request (ì˜ˆë¹„ìš”ì²­)

- ë¸Œë¼ìš°ì €ëŠ” ìš”ì²­ì„ í•œë²ˆì— ë³´ë‚´ì§€ ì•Šê³ , ì˜ˆë¹„ìš”ì²­ê³¼ ë³¸ìš”ì²­ìœ¼ë¡œ ë‚˜ëˆ„ì–´ ì„œë²„ì— ì „ë‹¬í•˜ëŠ”ë° ë¸Œë¼ìš°ì €ê°€ ì˜ˆë¹„ìš”ì²­ì„ ë³´ë‚´ëŠ” ê²ƒì„ Preflight ë¼ê³  í•˜ë©° ì´ ì˜ˆë¹„ìš”ì²­ì˜ ë©”ì†Œë“œì—ëŠ” OPTIONS ê°€ ì‚¬ìš©ëœë‹¤
- ì˜ˆë¹„ìš”ì²­ì˜ ì—­í• ì€ ë³¸ ìš”ì²­ì„ ë³´ë‚´ê¸° ì „ì— ë¸Œë¼ìš°ì € ìŠ¤ìŠ¤ë¡œ ì•ˆì „í•œ ìš”ì²­ì¸ì§€ í™•ì¸í•˜ëŠ” ê²ƒìœ¼ë¡œ ìš”ì²­ ì‚¬ì–‘ì´ Simple Request ì— í•´ë‹¹í•˜ì§€ ì•Šì„ ê²½ìš° ë¸Œë¼ìš°ì €ê°€ Preflight Request ì„ ì‹¤í–‰í•œë‹¤

![image](https://github.com/user-attachments/assets/735e07b7-ce79-40bc-8813-fc23b748b5b4)

### RequestHeader ì˜ˆì‹œ

![image](https://github.com/user-attachments/assets/bc30ec41-4566-4ae5-a102-222ea06f70bd)

- ë¸Œë¼ìš°ì €ê°€ ë³´ë‚¸ ìš”ì²­ì„ ë³´ë©´ Originì— ëŒ€í•œ ì •ë³´ ë¿ë§Œ ì•„ë‹ˆë¼ ì˜ˆë¹„ ìš”ì²­ ì´í›„ì— ì „ì†¡í•  ë³¸ ìš”ì²­ì— ëŒ€í•œ ë‹¤ë¥¸ ì •ë³´ë“¤ë„ í•¨ê»˜ í¬í•¨ë˜ì–´ ìˆëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆë‹¤.
- ì´ ì˜ˆë¹„ ìš”ì²­ì—ì„œ ë¸Œë¼ìš°ì €ëŠ” Access-Control-Request-Headers ë¥¼ ì‚¬ìš©í•˜ì—¬ ìì‹ ì´ ë³¸ ìš”ì²­ì—ì„œ Content-Type í—¤ë”ë¥¼ ì‚¬ìš©í•  ê²ƒì„ ì•Œë ¤ì£¼ê±°ë‚˜, Access-Control-Request-Methodë¥¼ ì‚¬ìš©í•˜ì—¬ GET ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•  ê²ƒì„ ì„œë²„ì—ê²Œ ë¯¸ë¦¬ ì•Œë ¤ì£¼ê³  ìˆë‹¤

### Response Header ì˜ˆì‹œ

![image](https://github.com/user-attachments/assets/3c531502-0663-4b10-8fd3-1312bf7c2895)

- ì„œë²„ê°€ ë³´ë‚´ì¤€ ì‘ë‹µ í—¤ë”ì— í¬í•¨ëœ Access-Control-Allow-Origin: https://security.io ì˜ ì˜ë¯¸ëŠ” í•´ë‹¹ URL ì™¸ì˜ ë‹¤ë¥¸ ì¶œì²˜ë¡œ ìš”ì²­í•  ê²½ìš°ì—ëŠ” CORS ì •ì±…ì„ ìœ„ë°˜í–ˆë‹¤ê³  íŒë‹¨í•˜ê³  ì˜¤ë¥˜ ë©”ì‹œì§€ë¥¼ ë‚´ê³  ì‘ë‹µì„ ë²„ë¦¬ê²Œ ëœë‹¤
