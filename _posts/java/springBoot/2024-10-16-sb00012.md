---
layout: single
title: "ğŸ§¾ ì™¸ë¶€ ì„¤ì •ì„ í™œìš©í•˜ëŠ” ìë™ êµ¬ì„±"
categories:
  - springBoot
toc: true
toc_sticky: true
author_profile: true
sidebar:
  nav: "sidebar-category"
---

## ìŠ¤í”„ë§ì˜ Environment ì¶”ìƒí™”

![image](https://github.com/user-attachments/assets/5b385a7f-2d4f-45c9-8e40-de1fe0f62bcc)

ìŠ¤í”„ë§ì˜ Environment ì¶”ìƒí™”ëŠ” ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë‘ ê°€ì§€ í™˜ê²½ ì •ë³´ ëª¨ë¸ì¸ profileê³¼ properties ë¥¼ ì œê³µí•œë‹¤.

ìë™ êµ¬ì„± ì •ë³´ì˜ ì¼ë¶€ ë‚´ìš©ì„ ë³€ê²½í•˜ê±°ë‚˜ ì„¤ì •í•´ì•¼í•  ë•Œ Environmentë¥¼ í†µí•´ì„œ í”„ë¡œí¼í‹° ê°’ì„ ê°€ì ¸ì™€ í™œìš©í•  ìˆ˜ ìˆë‹¤. ì»¤ìŠ¤í†° ë¹ˆ ë“±ë¡ì„ í•˜ëŠ” ë°©ë²•ì— ë¹„í•´ì„œ ê°„ë‹¨í•˜ê²Œ ìë™ êµ¬ì„±ì˜ ë””í´íŠ¸ ì„¤ì •ì„ ë³€ê²½í•˜ëŠ” ê²Œ ê°€ëŠ¥í•˜ë‹¤.

í”„ë¡œí¼í‹° ì •ë³´ëŠ” ì‹œìŠ¤í…œ í”„ë¡œí¼í‹°, í™˜ê²½ ë³€ìˆ˜, ì„œë¸”ë¦¿ íŒŒë¼ë¯¸í„°, JNDI ë“±ì—ì„œ ìš°ì„ ìˆœìœ„ì— ë”°ë¼ì„œ ê°€ì ¸ì˜¨ë‹¤. ì• í”Œë¦¬ì¼€ì´ì…˜ ì½”ë“œì—ì„œ @PropertySourceë¡œ í”„ë¡œí¼í‹° ê°’ì„ ê°€ì ¸ì˜¬ ëŒ€ìƒì„ ì§€ì •í•  ìˆ˜ ìˆë‹¤.

ìŠ¤í”„ë§ ë¶€íŠ¸ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ application.properties, application.xml, application.yml ë“±ì˜ íŒŒì¼ì—ì„œ í”„ë¡œí¼í‹°ë¥¼ ì½ì–´ì˜¤ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í–ˆë‹¤.

## ìë™ êµ¬ì„±ì— Environment í”„ë¡œí¼í‹° ì ìš©

ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ëª¨ë“  ì• í”Œë¦¬ì¼€ì´ì…˜ ì´ˆê¸°í™” ì‘ì—…ì´ ëë‚˜ê³  ë‚˜ë©´ ì‹¤í–‰ë˜ëŠ” ì½”ë“œë¥¼ ë§Œë“¤ ë•Œ ApplicationRunner ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•œ ì˜¤ë¸Œì íŠ¸ ë˜ëŠ” ëŒë‹¤ì‹ì„ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ë©´ ëœë‹¤.

```java
@Bean
ApplicationRunner applicationRunner(Environment environment) {
    return args -> {
        String name = environment.getProperty("my.name");
        System.out.println("my.name: " + name);
    };
}
```

ìë™ êµ¬ì„± í´ë˜ìŠ¤ì˜ ë©”ì†Œë“œì—ë„ Environmentë¥¼ ì£¼ì… ë°›ì•„ì„œ ë¹ˆ ì†ì„±ìœ¼ë¡œ ì§€ì •í•  í”„ë¡œí¼í‹° ê°’ì„ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.

```java
@Bean("tomcatWebServerFactory")
@ConditionalOnMissingBean
public ServletWebServerFactory servletWebServerFactory(Environment env) {
    TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();
    factory.setContextPath(env.getProperty("contextPath"));
    return factory;
}
```

## @Valueì™€ PropertySourcesPlaceholderConfigurer

@Value ì• ë…¸í…Œì´ì…˜ì€ ì—˜ë¦¬ë¨¼íŠ¸ë¡œ ì¹˜í™˜ì(placeholder)ë¥¼ ì§€ì •í•˜ê³  ì»¨í…Œì´ë„ˆ ì´ˆê¸°í™”ì‹œ í”„ë¡œí¼í‹° ê°’ìœ¼ë¡œ ì´ë¥¼ ëŒ€ì²´í•  ìˆ˜ ìˆë‹¤.

@Valueì˜ ì¹˜í™˜ìë¥¼ í”„ë¡œí¼í‹° ê°’ìœ¼ë¡œ êµì²´í•˜ë ¤ë©´ PropertySourcesPlaceholderConfigurer íƒ€ì…ì˜ ë¹ˆì„ ë“±ë¡í•´ì¤˜ì•¼ í•œë‹¤.
PropertySourcesPlaceholderConfigurerëŠ” ë¹ˆ íŒ©í† ë¦¬ì˜ í›„ì²˜ë¦¬ê¸°ë¡œ ë™ì‘í•´ì„œ ì´ˆê¸° êµ¬ì„± ì •ë³´ì—ì„œ ì¹˜í™˜ìë¥¼ ì°¾ì•„ì„œ êµì²´í•˜ëŠ” ê¸°ëŠ¥ì„ ë‹´ë‹¹í•œë‹¤.

PropertySourcesPlaceholderConfigurerë„ ìë™ êµ¬ì„± ë¹ˆìœ¼ë¡œ ë“±ë¡ë˜ê²Œ í•œë‹¤.

```java
@MyAutoConfiguration
public class PropertyPlaceholderConfig {
    @Bean PropertySourcesPlaceholderConfigurer propertySourcesPlaceholderConfigurer() {
        return new PropertySourcesPlaceholderConfigurer();
    }
}
```

## í”„ë¡œí¼í‹° í´ë˜ìŠ¤ì˜ ë¶„ë¦¬

ìë™ êµ¬ì„±ì— ì ìš©í•  í”„ë¡œí¼í‹°ì˜ ê°¯ìˆ˜ê°€ ë§ì•„ì§€ê³  í”„ë¡œí¼í‹°ë¥¼ ì²˜ë¦¬í•  ë¡œì§ì´ ì¶”ê°€ë˜ì•¼ í•œë‹¤ë©´, í”„ë¡œí¼í‹°ë¥¼ ë‹¤ë£¨ëŠ” ê¸°ëŠ¥ì„ ë³„ë„ì˜ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.

ê¸°ë³¸ì ì¸ í”„ë¡œí¼í‹° í´ë˜ìŠ¤ëŠ” í”„ë¡œí¼í‹° ê°’ì„ ê°€ì§€ê³  ìˆëŠ” ë‹¨ìˆœí•œ í´ë˜ìŠ¤ë¡œ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.

```java
public class ServerProperties {
    private String contextPath;
    private int port;

    public String getContextPath() {
        return contextPath;
    }
    public void setContextPath(String contextPath) {
        this.contextPath = contextPath;
    }
    public int getPort() {
        return port;
    }
    public void setPort(int port) {
        this.port = port;
    }
}
```

ì´ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ìë™ êµ¬ì„± í´ë˜ìŠ¤ë¥¼ ì¶”ê°€í•œë‹¤. Environmentì—ì„œ í”„ë¡œí¼í‹° ê°’ì„ ê°€ì ¸ì™€ ì˜¤ë¸Œì íŠ¸ì— ì£¼ì…í•˜ëŠ” ê²ƒì€ ìŠ¤í”„ë§ë¶€íŠ¸ì˜ Binder í´ë˜ìŠ¤ë¥¼ ì´ìš©í•˜ë©´ í¸ë¦¬í•˜ë‹¤.

```java
@MyAutoConfiguration
public class ServerPropertiesConfig {
    @Bean
    public ServerProperties serverProperties(Environment environment) {
        return Binder.get(environment).bind("", ServerProperties.class).get();
    }
}
```

í”„ë¡œí¼í‹° í´ë˜ìŠ¤ë¡œ ë§Œë“  ë¹ˆì€ ìë™ êµ¬ì„± ë¹ˆì„ ë§Œë“¤ ë•Œ ì£¼ì… ë°›ì•„ì„œ ì‚¬ìš©í•œë‹¤.

```java
@Bean("tomcatWebServerFactory")
@ConditionalOnMissingBean
public ServletWebServerFactory servletWebServerFactory(ServerProperties properties) {
    TomcatServletWebServerFactory factory = new TomcatServletWebServerFactory();

    factory.setContextPath(properties.getContextPath());
    factory.setPort(properties.getPort());

    return factory;
}
```

## í”„ë¡œí¼í‹° ë¹ˆì˜ í›„ì²˜ë¦¬ê¸° ë„ì…

í”„ë¡œí¼í‹° í´ë˜ìŠ¤ë¥¼ ë¹ˆ ë“±ë¡ì„ ìœ„í•œ ìë™ êµ¬ì„±ì„ ë”°ë¡œ ë§Œë“œëŠ” í•„ìš”í•œ ê³³ì—ì„œ @Import í•´ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤.

@MyConfigurationProperties ë¼ëŠ” ë§ˆì»¤ ì• ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ê³ , ì´ë¥¼ BeanPostProcessorë¥¼ ë§Œë“¤ì–´ì„œ ë¹ˆ ì˜¤ë¸Œì íŠ¸ ìƒì„± í›„ì— í›„ì²˜ë¦¬ ì‘ì—…ì„ ì§„í–‰ì‹œí‚¬ ìˆ˜ ìˆë‹¤.

```java
public interface BeanPostProcessor {
    default Object postProcessBeforeInitialization(Object bean, String beanName) throws BeansException {
        return bean;
    }

    default Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
        return bean;
    }
}
```

ë§ˆì»¤ ì• ë…¸í…Œì´ì…˜ì„ ì°¾ì•„ì„œ í”„ë¡œí¼í‹°ë¥¼ ì£¼ì…í•˜ëŠ” ê¸°ëŠ¥ì„ ì´ ì¸í„°í˜ì´ìŠ¤ë¥¼ êµ¬í˜„í•´ì„œ ë§Œë“¤ê³  ìë™ êµ¬ì„±ìœ¼ë¡œ ë“±ë¡ë˜ê²Œ í•œë‹¤.

```java
@MyAutoConfiguration
public class PropertyPostProcessorConfig {
    @Bean BeanPostProcessor propertyPostProcessor(Environment env) {
        return new BeanPostProcessor() {
            @Override
            public Object postProcessAfterInitialization(Object bean, String beanName) throws BeansException {
                MyConfigurationProperties annotation = findAnnotation(bean.getClass(), MyConfigurationProperties.class);
                if (annotation == null) return bean;

                Map<String, Object> attrs = getAnnotationAttributes(annotation);
                String prefix = (String) attrs.get("prefix");

                return Binder.get(env).bindOrCreate(prefix, bean.getClass());
            }
        };
    }
}
```

ë§ˆì»¤ ì• ë…¸í…Œì´ì…˜ì— prefix ì—˜ë¦¬ë¨¼íŠ¸ë¥¼ ì§€ì •í•˜ê²Œ í•˜ê³ , ì´ë¥¼ ì´ìš©í•´ì„œ í”„ë¡œí¼í‹° ì´ë¦„ ì•ì— ì ‘ë‘ì–´ë¥¼ ë¶™ì´ë„ë¡ í•  ìˆ˜ ìˆë‹¤.

```java
@Retention(RetentionPolicy.RUNTIME)
@Target(ElementType.TYPE)
@Component
public @interface MyConfigurationProperties {
    String prefix();
}
```

ì• ë…¸í…Œì´ì…˜ê³¼ ImportSelectorë¥¼ ì¡°í•©í•´ì„œ ì• ë…¸í…Œì´ì…˜ì˜ ì—˜ë¦¬ë¨¼íŠ¸ ê°’ìœ¼ë¡œ ì§€ì •í•œ í´ë˜ìŠ¤ë¥¼ ë¹ˆìœ¼ë¡œ ë“±ë¡í•˜ëŠ” ë°©ë²•ë„ ê°€ëŠ¥í•˜ë‹¤.

```java
public class MyConfigurationPropertiesImportSelector implements DeferredImportSelector {
    @Override
    public String[] selectImports(AnnotationMetadata importingClassMetadata) {
        MultiValueMap<String, Object> attr = importingClassMetadata.getAllAnnotationAttributes(EnableMyConfigurationProperties.class.getName());
        Class propertyClass = (Class) attr.getFirst("value");
        return new String[] {propertyClass.getName()};
    }
}
```

ì´ë•ŒëŠ” ê¸°ë³¸ ì—˜ë¦¬ë¨¼íŠ¸ íƒ€ì…ì„ Class íƒ€ì…ìœ¼ë¡œ ë§Œë“¤ì–´ ì‚¬ìš©í•œë‹¤.
